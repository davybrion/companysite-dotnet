<p>One question that occasionally comes up is how a client can use multiple Agatha services.&#160; While it’s not possible with Agatha’s out-of-the-box configuration and usage patterns, it can be done if you’re willing to write a little bit of glue code. So, let’s go through the steps to make it work. I’m gonna use one of our Silverlight applications for this example, but it works just the same for regular .NET clients.</p>  <p>First of all, the Silverlight client’s WCF config has 2 defined endpoints:</p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;</span><span style="color: #a31515">client</span><span style="color: blue">&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">endpoint</span><span style="color: blue"> </span><span style="color: red">binding</span><span style="color: blue">=</span>&quot;<span style="color: blue">basicHttpBinding</span>&quot;<span style="color: blue"> </span><span style="color: red">bindingConfiguration</span><span style="color: blue">=</span>&quot;<span style="color: blue">firstServiceBinding</span>&quot;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: red">contract</span><span style="color: blue">=</span>&quot;<span style="color: blue">Agatha.Common.WCF.IWcfRequestProcessor</span>&quot;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">firstService</span>&quot;<span style="color: blue"> /&gt;</span></p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160; &lt;</span><span style="color: #a31515">endpoint</span><span style="color: blue"> </span><span style="color: red">binding</span><span style="color: blue">=</span>&quot;<span style="color: blue">basicHttpBinding</span>&quot;<span style="color: blue"> </span><span style="color: red">bindingConfiguration</span><span style="color: blue">=</span>&quot;<span style="color: blue">secondServiceBinding</span>&quot;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: red">contract</span><span style="color: blue">=</span>&quot;<span style="color: blue">Agatha.Common.WCF.IWcfRequestProcessor</span>&quot;</p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </span><span style="color: red">name</span><span style="color: blue">=</span>&quot;<span style="color: blue">secondService</span>&quot;<span style="color: blue"> /&gt;</span></p>    <p style="margin: 0px"><span style="color: blue">&#160;&#160;&#160; &lt;/</span><span style="color: #a31515">client</span><span style="color: blue">&gt;</span></p> </div>  <p>&#160;</p>  <p>Notice that each endpoint has a defined name. </p>  <p>Now you can create 2 new service proxies which inherit from Agatha’s proxy:</p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">FirstServiceProxy</span> : Agatha.Common.WCF.<span style="color: #2b91af">AsyncRequestProcessorProxy</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> FirstServiceProxy()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : <span style="color: blue">base</span>(<span style="color: #a31515">&quot;firstService&quot;</span>, GetServiceUrl()) {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">string</span> GetServiceUrl()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// return the correct url from somewhere...</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SecondServiceProxy</span> : Agatha.Common.WCF.<span style="color: #2b91af">AsyncRequestProcessorProxy</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> SecondServiceProxy()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : <span style="color: blue">base</span>(<span style="color: #a31515">&quot;secondService&quot;</span>, GetServiceUrl()) {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">private</span> <span style="color: blue">static</span> <span style="color: blue">string</span> GetServiceUrl()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: green">// return the correct url from somewhere...</span></p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p> </div>  <p>&#160;</p>  <p>Once you have those proxies, you can create new request dispatchers, which also inherit from Agatha’s:</p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">IFirstDispatcher</span> : Agatha.Common.<span style="color: #2b91af">IAsyncRequestDispatcher</span> {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">FirstDispatcher</span> : Agatha.Common.<span style="color: #2b91af">AsyncRequestDispatcher</span>, <span style="color: #2b91af">IFirstDispatcher</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> FirstDispatcher(<span style="color: #2b91af">FirstServiceProxy</span> requestProcessor) : <span style="color: blue">base</span>(requestProcessor) { }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">ISecondDispatcher</span> : Agatha.Common.<span style="color: #2b91af">IAsyncRequestDispatcher</span> {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SecondDispatcher</span> : Agatha.Common.<span style="color: #2b91af">AsyncRequestDispatcher</span>, <span style="color: #2b91af">ISecondDispatcher</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> SecondDispatcher(<span style="color: #2b91af">SecondServiceProxy</span> requestProcessor) : <span style="color: blue">base</span>(requestProcessor) { }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p> </div>  <p>&#160;</p>  <p>If you register those types with your container (make sure it’s the same container instance that Agatha uses) and you can have the correct dispatchers injected for whichever service you want to communicate with.&#160; But in the case of asynchronous request dispatchers, you typically use a factory to get them, so you probably want to add something like this:</p>  <div style="font-family: consolas; background: white; color: black; font-size: 10pt">   <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">IFirstDispatcherFactory</span> : Agatha.Common.<span style="color: #2b91af">IAsyncRequestDispatcherFactory</span> {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">FirstDispatcherFactory</span> : <span style="color: #2b91af">IFirstDispatcherFactory</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">IAsyncRequestDispatcher</span> CreateAsyncRequestDispatcher()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #2b91af">IoC</span>.Container.Resolve&lt;<span style="color: #2b91af">IFirstDispatcher</span>&gt;();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">ISecondDispatcherFactory</span> : Agatha.Common.<span style="color: #2b91af">IAsyncRequestDispatcherFactory</span> {}</p>    <p style="margin: 0px">&#160;</p>    <p style="margin: 0px">&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: blue">class</span> <span style="color: #2b91af">SecondDispatcherFactory</span> : <span style="color: #2b91af">ISecondDispatcherFactory</span></p>    <p style="margin: 0px">&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">public</span> <span style="color: #2b91af">IAsyncRequestDispatcher</span> CreateAsyncRequestDispatcher()</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> <span style="color: #2b91af">IoC</span>.Container.Resolve&lt;<span style="color: #2b91af">ISecondDispatcher</span>&gt;();</p>    <p style="margin: 0px">&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>    <p style="margin: 0px">&#160;&#160;&#160; }</p> </div>  <p>&#160;</p>  <p>And there you go… inject the proper factory (or both of them) and just use whichever one you need to get a dispatcher for the service you want. </p>